___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Contimo",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Allow to track conversions in Contimo",
  "categories": ["AFFILIATE_MARKETING", "ADVERTISING", "CONVERSIONS", "ATTRIBUTION"],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "action",
    "displayName": "Action",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "init",
        "displayValue": "Init"
      },
      {
        "value": "track_conversion",
        "displayValue": "Track conversion"
      }
    ],
    "simpleValueType": true,
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "clickid_param",
    "displayName": "Click ID parameter name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "action",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ],
    "defaultValue": "sclid"
  },
  {
    "type": "SELECT",
    "name": "conversion_type",
    "displayName": "Conversion type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "purchase",
        "displayValue": "Purchase"
      },
      {
        "value": "qualified_visit",
        "displayValue": "Qualified visit"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "action",
        "paramValue": "track_conversion",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "revenue",
    "displayName": "Transaction revenue",
    "simpleValueType": true,
    "help": "Provide transaction revenue for ROAS analysis",
    "canBeEmptyString": true,
    "enablingConditions": [
      {
        "paramName": "conversion_type",
        "paramValue": "purchase",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "revenue_currency",
    "displayName": "Revenue currency",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "DKK",
        "displayValue": "DKK"
      },
      {
        "value": "EUR",
        "displayValue": "EUR"
      },
      {
        "value": "USD",
        "displayValue": "USD"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "conversion_type",
        "paramValue": "purchase",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "params",
    "displayName": "Additional params (optional)",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Key",
        "name": "key",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "action",
        "paramValue": "track_conversion",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Imports
const queryPermission    = require('queryPermission');
const getUrl             = require('getUrl');
const localStorage       = require('localStorage');
const getCookieValues    = require('getCookieValues');
const setCookie          = require('setCookie');
const sendPixel          = require('sendPixel');
const encodeUriComponent = require('encodeUriComponent');
const logToConsole       = require('logToConsole');

const STORAGE_KEY = 'contimo_clickId';

function init(data) {
    if (queryPermission('get_url', 'query', data.clickid_param)) {
    const clickId = getUrl('query', false, null, data.clickid_param);
    if (clickId) {
      if (queryPermission('access_local_storage', 'write', STORAGE_KEY)) {
        logToConsole(localStorage);
        localStorage.setItem(STORAGE_KEY, clickId);
      } else if (queryPermission('set_cookies', STORAGE_KEY)) {
        setCookie(STORAGE_KEY, clickId, { path: '/' });
      }
    }
  }

  data.gtmOnSuccess();
}

function trackConversion(data) {
    // Retrieve clickId
  let clickId;
  if (queryPermission('access_local_storage', 'read', STORAGE_KEY)) {
    clickId = localStorage.getItem(STORAGE_KEY);
  } else if (queryPermission('get_cookies', STORAGE_KEY)) {
    const cookies = getCookieValues(STORAGE_KEY);
    clickId = (cookies && cookies[0]);
  }

  if (!clickId) {
    // Nothing to fire
    data.gtmOnSuccess();
  } else {
    // Build URL
    let url = 'https://aj2438.online/at';
    const params = [
      'actionKey=b4e4e9ac23c8742163c2ffa1edd2e2fc-229-0',
      'actionData=' + encodeUriComponent(clickId)
    ];
    if (data.conversion_type === 'purchase') {
      params.push(
        'cp.revenue=' +
        encodeUriComponent((data.revenue || '') +
                           (data.revenue_currency || ''))
      );
    }
    params.push('cp.ct=' + encodeUriComponent(data.conversion_type));
    
    (data.params || []).forEach(function(kv) { 
      let key = encodeUriComponent(kv.key);
      let value = encodeUriComponent(kv.value);
      params.push(['cp.', key, '=', value].join('')); 
    });

    params.push('cp.source=gtm');
    

    url += '?' + params.join('&');
    logToConsole(url);
    // Fire pixel with callbacks
    sendPixel(url, data.gtmOnSuccess, data.gtmOnFailure);
  }
}

//logToConsole(data);
if (data.action === 'init') {
  init(data);
} else if (data.action === 'track_conversion') {
  trackConversion(data);
} else {
  // Unrecognized action
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "contimo_clickId"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "contimo_clickId"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://aj2438.online/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "contimo_clickId"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Persists to Local Storage
  code: "// Arrange\nrunTestSetup();\nconst mockData = { action: 'init', clickid_param:\
    \ 'cid' };\n// Simulate finding ?cid=ABC123\n_stubUrlValue = 'https://localhost/?cid=ABC123';\n\
    \n// Act\nrunCode(mockData);\n\n// Assert\nassertApi('getUrl').wasCalledWith('query',\
    \ false, null, 'cid');  \nassertApi('localStorage.setItem').wasCalledWith('contimo_clickId',\
    \ 'ABC123');  \nassertApi('gtmOnSuccess').wasCalled();  "
- name: Fire converstion (purchase) pixel
  code: "const mockData = {\n  action: 'track_conversion', \n  conversion_type: 'purchase',\n\
    \  revenue_currency: 'DKK',\n  revenue: '10',\n  gtmOnSuccess: function() { },\n\
    \  gtmOnFailure: function() { }\n};\n\n_storage.contimo_clickId = 'ABC123';\n\n\
    const expectedUrl = 'https://aj2438.online/at?actionKey=b4e4e9ac23c8742163c2ffa1edd2e2fc-229-0&actionData=ABC123&cp.revenue=10DKK&cp.ct=purchase&cp.source=gtm';\n\
    \nmock('sendPixel', function(url, onSuccess, onFailure) {\n  assertThat(url).isEqualTo(expectedUrl);\n\
    \  assertThat(typeof onSuccess).isEqualTo('function');\n  assertThat(typeof onFailure).isEqualTo('function');\n\
    });\n\nrunCode(mockData);\n\nlogToConsole(mockData);\n\n// Verify that the tag\
    \ finished successfully.\nassertApi('sendPixel').wasCalled();"
- name: Fire converstion (qualified_visit) pixel
  code: "const mockData = {\n  action: 'track_conversion', \n  conversion_type: 'qualified_visit',\n\
    \  gtmOnSuccess: function() { },\n  gtmOnFailure: function() { }\n};\n\n_storage.contimo_clickId\
    \ = 'ABC123';\n\nconst expectedUrl = 'https://aj2438.online/at?actionKey=b4e4e9ac23c8742163c2ffa1edd2e2fc-229-0&actionData=ABC123&cp.ct=qualified_visit&cp.source=gtm';\n\
    \nmock('sendPixel', function(url, onSuccess, onFailure) {\n  assertThat(url).isEqualTo(expectedUrl);\n\
    \  assertThat(typeof onSuccess).isEqualTo('function');\n  assertThat(typeof onFailure).isEqualTo('function');\n\
    });\n\nrunCode(mockData);\n\nlogToConsole(mockData);\n\n// Verify that the tag\
    \ finished successfully.\nassertApi('sendPixel').wasCalled();"
- name: Make urlEscape & custom parameters
  code: "const mockData = {\n  action: 'track_conversion', \n  conversion_type: 'purchase',\n\
    \  revenue_currency: 'DKK',\n  revenue: '10',\n  params: [\n    { key: \"a\",\
    \ value: \"b=\" }\n  ]\n};\n\n_storage.contimo_clickId = 'ABC&123';\n\nconst expectedUrl\
    \ = 'https://aj2438.online/at?actionKey=b4e4e9ac23c8742163c2ffa1edd2e2fc-229-0&actionData=ABC%26123&cp.revenue=10DKK&cp.ct=purchase&cp.a=b%3D&cp.source=gtm';\n\
    \nmock('sendPixel', function(url, onSuccess, onFailure) {\n  assertThat(url).isEqualTo(expectedUrl);\n\
    \  assertThat(typeof onSuccess).isEqualTo('function');\n  assertThat(typeof onFailure).isEqualTo('function');\n\
    });\n\nrunCode(mockData);\n\nlogToConsole(mockData);\n\n// Verify that the tag\
    \ finished successfully.\nassertApi('sendPixel').wasCalled();"
setup: |-
  const logToConsole       = require('logToConsole');

  mock('queryPermission', (perm) => {
    return true;
  });

  let _storage = {};
  let _stubUrlValue = '';
  mock('getUrl', (_type, _encode, _name, paramName) => {
    logToConsole({_type: _type, _encode: _encode, _name: _name, paramName: paramName});
    return _stubUrlValue;
  });


  mockObject('localStorage', {
    getItem: (key) => _storage[key] || null,
    setItem: (key, value) => { _storage[key] = value; }
  });

  mock('getCookieValues', (key) => _storage[key] ? [ _storage[key] ] : []);
  mock('setCookie', (key, value, opts) => { _storage[key] = value; });

  function runTestSetup() {
    _storage = {};
  }


___NOTES___

Created on 7/28/2025, 11:14:51 AM


